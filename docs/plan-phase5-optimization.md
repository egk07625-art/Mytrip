# Phase 5: 최적화 & 배포 계획 (TODO 376-399)

> **목표**: 프로덕션 배포 준비 및 코드 품질 최종 검증

## 📋 작업 범위

### 완료된 항목 (제외)
- ✅ API 클라이언트에서 환경변수 처리 구현
- ✅ 환경변수 설정 가이드 작성
- ✅ Server Component baseUrl 결정 로직 개선
- ✅ Next.js 15 headers() API 사용
- ✅ 디버깅 로그 강화
- ✅ Vercel 관련 가이드 문서 작성
- ✅ Next.js 15 동적 라우트 파라미터 처리

### 미완료 항목 (계획 대상)

1. **성능 측정 (Lighthouse 점수 > 80)**
2. **환경변수 보안 검증 (TOUR_API_KEY 확인)**
3. **Vercel 배포 및 테스트**
4. **최종 가이드라인 준수 체크리스트**
   - 불필요한 추상화 검증
   - Export 규칙 준수 검증
   - 네이밍 규칙 준수 검증
   - Spacing-First 정책 준수 검증
   - Tailwind CSS 우선 사용 검증
   - TypeScript 타입 정의 완료 검증
   - 반응형 디자인 검증

---

## 🎯 1. 성능 측정 (Lighthouse 점수 > 80)

### 목표
- Performance: 80점 이상
- Accessibility: 90점 이상
- Best Practices: 90점 이상
- SEO: 90점 이상

### 구현 계획

#### 1.1 성능 측정 도구 설정
- **Chrome DevTools Lighthouse** 활용
- **Vercel Analytics** 통합 (선택 사항)
- **Web Vitals** 모니터링 설정

#### 1.2 성능 최적화 항목
1. **이미지 최적화**
   - ✅ Next.js Image 컴포넌트 사용 검증
   - ✅ 이미지 lazy loading 적용
   - ✅ 적절한 이미지 포맷 사용 (WebP 우선)
   - ✅ 이미지 크기 최적화

2. **코드 분할 (Code Splitting)**
   - 동적 import 활용 검증
   - 라우트별 코드 분할 확인
   - 불필요한 번들 크기 확인

3. **캐싱 전략**
   - API 응답 캐싱 (revalidate 설정 확인)
   - 정적 자산 캐싱 헤더 설정
   - ISR/SSG 활용 검증

4. **렌더링 최적화**
   - 불필요한 리렌더링 방지
   - React.memo 활용 검증
   - Suspense 경계 최적화

#### 1.3 측정 및 개선 프로세스
1. 로컬 환경에서 Lighthouse 측정
2. Vercel 배포 후 Production 환경 측정
3. 점수 미달 항목 분석 및 개선
4. 재측정 및 목표 달성 확인

### 확장성 고려사항
- 성능 모니터링 자동화 (CI/CD 통합)
- 성능 회귀 방지 (성능 테스트 자동화)

### 잠재 오류 분석

#### 오류 1: 이미지 최적화 실패
- **확률**: 30%
- **원인**: 외부 이미지 URL이 Next.js Image 컴포넌트와 호환되지 않음
- **대응**: `next.config.ts`의 `remotePatterns` 설정 검증, 이미지 프록시 서버 고려

#### 오류 2: 번들 크기 과다
- **확률**: 40%
- **원인**: 불필요한 라이브러리 포함, 트리 쉐이킹 미적용
- **대응**: 번들 분석 도구 활용, 동적 import 적용, 사용하지 않는 의존성 제거

#### 오류 3: API 응답 지연
- **확률**: 20%
- **원인**: 외부 API 응답 시간, 네트워크 지연
- **대응**: 적절한 캐싱 전략, 로딩 상태 최적화, 에러 핸들링 강화

---

## 🔒 2. 환경변수 보안 검증 (TOUR_API_KEY 확인)

### 목표
- 환경변수 존재 여부 검증
- 환경변수 형식 검증
- 보안 취약점 점검

### 구현 계획

#### 2.1 환경변수 검증 스크립트 작성
**파일**: `scripts/verify-env.ts`

```typescript
// 환경변수 검증 로직
// - 필수 환경변수 존재 확인
// - 환경변수 형식 검증 (예: API 키 길이, 접두사 확인)
// - 보안 취약점 점검 (예: 공개 저장소 노출 방지)
```

#### 2.2 검증 항목
1. **필수 환경변수 존재 확인**
   - `TOUR_API_KEY` 또는 `NEXT_PUBLIC_TOUR_API_KEY`
   - `NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY`
   - `CLERK_SECRET_KEY`
   - `NEXT_PUBLIC_SUPABASE_URL`
   - `NEXT_PUBLIC_SUPABASE_ANON_KEY`
   - `SUPABASE_SERVICE_ROLE_KEY`

2. **환경변수 형식 검증**
   - API 키 길이 검증
   - API 키 접두사 검증 (예: Clerk 키는 `pk_` 또는 `sk_`로 시작)
   - URL 형식 검증 (Supabase URL)

3. **보안 점검**
   - `.env.local`이 `.gitignore`에 포함되어 있는지 확인
   - 환경변수가 코드에 하드코딩되지 않았는지 확인
   - 프로덕션 환경변수가 개발 키가 아닌지 확인

#### 2.3 검증 실행 방법
```bash
# 개발 환경 검증
pnpm verify:env

# CI/CD 통합 (GitHub Actions 등)
# 빌드 전 자동 검증
```

### 확장성 고려사항
- 환경별 검증 규칙 분리 (개발/프로덕션)
- 환경변수 템플릿 자동 생성

### 잠재 오류 분석

#### 오류 1: 환경변수 누락
- **확률**: 25%
- **원인**: Vercel 등 배포 환경에서 환경변수 미설정
- **대응**: 검증 스크립트로 사전 확인, 명확한 에러 메시지 제공

#### 오류 2: 잘못된 환경변수 형식
- **확률**: 15%
- **원인**: 환경변수 값 오타, 잘못된 키 사용
- **대응**: 형식 검증 로직 추가, 명확한 에러 메시지

#### 오류 3: 보안 취약점 (API 키 노출)
- **확률**: 10%
- **원인**: 환경변수가 공개 저장소에 커밋됨
- **대응**: `.gitignore` 검증, pre-commit 훅으로 방지

---

## 🚀 3. Vercel 배포 및 테스트

### 목표
- Vercel 프로덕션 배포 성공
- 배포 후 주요 기능 동작 확인
- 환경변수 정상 작동 확인

### 구현 계획

#### 3.1 배포 전 체크리스트
1. **환경변수 설정 확인**
   - Vercel Dashboard에서 모든 필수 환경변수 설정 확인
   - 환경별(Production/Preview/Development) 환경변수 확인

2. **빌드 테스트**
   - 로컬에서 `pnpm build` 성공 확인
   - 빌드 에러 없음 확인

3. **타입 체크**
   - `pnpm type-check` 또는 `tsc --noEmit` 실행
   - TypeScript 에러 없음 확인

#### 3.2 배포 프로세스
1. **GitHub 연동 확인**
   - Vercel과 GitHub 저장소 연동 확인
   - 자동 배포 설정 확인

2. **배포 실행**
   - `main` 브랜치에 푸시하여 자동 배포
   - 또는 Vercel Dashboard에서 수동 배포

3. **배포 후 확인**
   - 배포 URL 접속 확인
   - 주요 페이지 로딩 확인
   - API 호출 정상 작동 확인

#### 3.3 배포 후 테스트 항목
1. **기본 기능 테스트**
   - [ ] 홈페이지 로딩 (관광지 목록 표시)
   - [ ] 검색 기능 동작
   - [ ] 필터 기능 동작
   - [ ] 상세페이지 이동 및 표시
   - [ ] 북마크 기능 동작 (인증 필요)

2. **인증 기능 테스트**
   - [ ] 로그인/로그아웃 동작
   - [ ] 사용자 동기화 확인

3. **에러 처리 테스트**
   - [ ] API 에러 시 에러 메시지 표시
   - [ ] 404 페이지 표시
   - [ ] 네트워크 에러 처리

4. **성능 테스트**
   - [ ] Lighthouse 점수 측정
   - [ ] 페이지 로딩 속도 확인
   - [ ] 이미지 로딩 확인

### 확장성 고려사항
- Preview 배포 자동화 (PR별 배포)
- 배포 알림 설정 (Slack, Discord 등)
- 배포 롤백 프로세스 수립

### 잠재 오류 분석

#### 오류 1: 빌드 실패
- **확률**: 30%
- **원인**: 환경변수 누락, 타입 에러, 의존성 문제
- **대응**: 로컬 빌드 테스트 필수, CI/CD에서 사전 검증

#### 오류 2: 런타임 에러
- **확률**: 25%
- **원인**: 환경변수 미설정, API 호출 실패, 클라이언트/서버 불일치
- **대응**: 배포 후 즉시 주요 기능 테스트, 에러 모니터링 설정

#### 오류 3: 성능 저하
- **확률**: 20%
- **원인**: 이미지 최적화 미적용, 번들 크기 과다, 캐싱 미설정
- **대응**: Lighthouse 측정, 성능 최적화 적용

---

## ✅ 4. 최종 가이드라인 준수 체크리스트

### 목표
- 코드 품질 일관성 확보
- 가이드라인 준수 여부 검증
- 자동화된 검증 도구 구축

### 구현 계획

#### 4.1 불필요한 추상화 검증
**검증 방법**: 코드 리뷰 + 자동화 스크립트

**검증 항목**:
- [ ] 단순 스타일링만 하는 래퍼 컴포넌트 없음
- [ ] 의미 없는 컨테이너 컴포넌트 없음
- [ ] 불필요한 배럴 익스포트 없음

**검증 대상 파일**:
- `components/` 디렉토리 전체
- 각 컴포넌트 파일 검토

**자동화 스크립트**: `scripts/verify-abstractions.ts`
- 단순 래퍼 컴포넌트 패턴 감지
- 불필요한 추상화 경고

#### 4.2 Export 규칙 준수 검증
**검증 방법**: ESLint 규칙 + 수동 검토

**검증 항목**:
- [ ] 단일 컴포넌트는 `export default` 사용
- [ ] 다중 export는 named export 사용
- [ ] 페이지 컴포넌트는 항상 `export default`
- [ ] UI 라이브러리(shadcn)는 named export 유지

**검증 대상 파일**:
- `components/` 디렉토리 전체
- `app/` 디렉토리 전체

**자동화**: ESLint 규칙 추가 (선택 사항)

#### 4.3 네이밍 규칙 준수 검증
**검증 방법**: ESLint 규칙 + 수동 검토

**검증 항목**:
- [ ] 컴포넌트: PascalCase (`TourCard`, `TourList`)
- [ ] 파일명: kebab-case (`tour-card.tsx`)
- [ ] 훅: camelCase with `use` prefix (`useTour`)
- [ ] 타입: PascalCase (`TourItem`)
- [ ] 금지어 사용 안 함 (`Common`, `Base`, `Util`, `Index`, `Styled*`)

**검증 대상 파일**:
- 전체 프로젝트

**자동화**: ESLint 규칙 활용

#### 4.4 Spacing-First 정책 준수 검증
**검증 방법**: 코드 리뷰 + 자동화 스크립트

**검증 항목**:
- [ ] 형제 요소 간 간격은 `gap` 사용 (margin 사용 안 함)
- [ ] 외곽 여백은 최상단 래퍼의 `padding` 사용
- [ ] `mt-`, `mb-`, `mx-`, `my-` 클래스 사용 최소화

**검증 대상 파일**:
- `components/` 디렉토리 전체
- `app/` 디렉토리 전체

**자동화 스크립트**: `scripts/verify-spacing.ts`
- margin 클래스 사용 패턴 감지
- 경고 메시지 출력

#### 4.5 Tailwind CSS 우선 사용 검증
**검증 방법**: 코드 리뷰 + 자동화 스크립트

**검증 항목**:
- [ ] 인라인 `style={{ }}` 사용 안 함
- [ ] `styled-jsx` 사용 안 함
- [ ] Tailwind 유틸리티 클래스 사용

**검증 대상 파일**:
- 전체 프로젝트 (`.tsx`, `.ts` 파일)

**자동화 스크립트**: `scripts/verify-styling.ts`
- 인라인 style 패턴 감지
- styled-jsx 사용 감지

#### 4.6 TypeScript 타입 정의 완료 검증
**검증 방법**: TypeScript 컴파일러

**검증 항목**:
- [ ] 모든 컴포넌트 Props 타입 정의
- [ ] 모든 함수 파라미터/반환 타입 정의
- [ ] `any` 타입 사용 최소화
- [ ] 타입 에러 없음

**검증 명령어**:
```bash
pnpm type-check
# 또는
tsc --noEmit
```

#### 4.7 반응형 디자인 검증
**검증 방법**: 수동 테스트 + 자동화 도구

**검증 항목**:
- [ ] 모바일 (375px) 레이아웃 정상
- [ ] 태블릿 (768px) 레이아웃 정상
- [ ] 데스크톱 (1024px+) 레이아웃 정상
- [ ] 다크 모드 지원 확인

**검증 방법**:
1. Chrome DevTools 반응형 모드 테스트
2. 실제 디바이스 테스트 (선택 사항)
3. 자동화: Playwright 반응형 테스트 (선택 사항)

**검증 대상 페이지**:
- `/` (홈페이지)
- `/places/[contentId]` (상세페이지)
- `/bookmarks` (북마크 페이지)

### 확장성 고려사항
- CI/CD에 검증 스크립트 통합
- Pre-commit 훅으로 자동 검증
- 검증 리포트 자동 생성

### 잠재 오류 분석

#### 오류 1: 가이드라인 미준수 발견
- **확률**: 50%
- **원인**: 기존 코드의 가이드라인 미준수, 새로운 코드 작성 시 실수
- **대응**: 점진적 개선, 자동화 도구로 사전 방지

#### 오류 2: 자동화 스크립트 오탐
- **확률**: 20%
- **원인**: 복잡한 패턴 인식 실패, 예외 케이스 미고려
- **대응**: 스크립트 개선, 수동 검토 병행

#### 오류 3: 반응형 디자인 이슈
- **확률**: 30%
- **원인**: 특정 브레이크포인트에서 레이아웃 깨짐, 다크 모드 스타일 누락
- **대응**: 다양한 디바이스 테스트, 자동화 테스트 도구 활용

---

## 📝 MVP 사용 룰

### 최소 기능 집합 (MVP)
다음 기능들이 정상 작동해야 MVP로 간주:

1. **기본 기능**
   - ✅ 관광지 목록 표시
   - ✅ 관광지 상세 정보 표시
   - ✅ 검색 기능
   - ✅ 필터 기능

2. **인증 기능**
   - ✅ 로그인/로그아웃
   - ✅ 북마크 기능 (인증 필요)

3. **성능**
   - ✅ Lighthouse Performance 80점 이상
   - ✅ 주요 페이지 로딩 시간 3초 이내

4. **안정성**
   - ✅ 주요 기능 에러 없음
   - ✅ 환경변수 정상 작동
   - ✅ Vercel 배포 성공

### MVP 달성 기준
- [ ] 모든 MVP 기능 정상 작동
- [ ] 성능 목표 달성
- [ ] 가이드라인 준수 체크리스트 80% 이상 통과
- [ ] 배포 성공 및 주요 기능 테스트 통과

---

## 🧪 테스트 계획

### 1. 성능 테스트
- [ ] Lighthouse 측정 (로컬)
- [ ] Lighthouse 측정 (프로덕션)
- [ ] Web Vitals 측정
- [ ] 번들 크기 분석

### 2. 기능 테스트
- [ ] 홈페이지 기능 테스트
- [ ] 상세페이지 기능 테스트
- [ ] 북마크 기능 테스트
- [ ] 인증 기능 테스트

### 3. 환경변수 검증 테스트
- [ ] 로컬 환경 검증
- [ ] Vercel 환경 검증
- [ ] 환경변수 형식 검증

### 4. 가이드라인 준수 테스트
- [ ] 불필요한 추상화 검증
- [ ] Export 규칙 검증
- [ ] 네이밍 규칙 검증
- [ ] Spacing-First 정책 검증
- [ ] Tailwind CSS 사용 검증
- [ ] TypeScript 타입 검증
- [ ] 반응형 디자인 검증

### 5. 배포 테스트
- [ ] 빌드 테스트
- [ ] 배포 후 기능 테스트
- [ ] 배포 후 성능 테스트
- [ ] 에러 처리 테스트

---

## 📅 실행 순서

1. **1단계: 환경변수 보안 검증** (우선순위: 높음)
   - 검증 스크립트 작성
   - 로컬/프로덕션 환경 검증

2. **2단계: 최종 가이드라인 준수 체크리스트** (우선순위: 높음)
   - 각 항목별 검증 스크립트 작성
   - 코드 리뷰 및 개선

3. **3단계: 성능 측정 및 최적화** (우선순위: 중간)
   - Lighthouse 측정
   - 성능 최적화 적용
   - 재측정

4. **4단계: Vercel 배포 및 테스트** (우선순위: 높음)
   - 배포 전 체크리스트 확인
   - 배포 실행
   - 배포 후 테스트

---

## 📊 진행 상황 추적

각 작업 항목은 TODO.md에 체크리스트로 관리:

```markdown
- [ ] 성능 측정 (Lighthouse 점수 > 80)
  - [ ] 성능 측정 도구 설정
  - [ ] 이미지 최적화 검증
  - [ ] 코드 분할 검증
  - [ ] 캐싱 전략 검증
  - [ ] Lighthouse 측정 및 목표 달성

- [ ] 환경변수 보안 검증
  - [ ] 검증 스크립트 작성
  - [ ] 필수 환경변수 검증
  - [ ] 환경변수 형식 검증
  - [ ] 보안 점검

- [ ] Vercel 배포 및 테스트
  - [ ] 배포 전 체크리스트 확인
  - [ ] 배포 실행
  - [ ] 배포 후 기능 테스트
  - [ ] 배포 후 성능 테스트

- [ ] 최종 가이드라인 준수 체크리스트
  - [ ] 불필요한 추상화 검증
  - [ ] Export 규칙 검증
  - [ ] 네이밍 규칙 검증
  - [ ] Spacing-First 정책 검증
  - [ ] Tailwind CSS 사용 검증
  - [ ] TypeScript 타입 검증
  - [ ] 반응형 디자인 검증
```

---

## 🎯 성공 기준

### Phase 5 완료 기준
1. ✅ Lighthouse Performance 80점 이상
2. ✅ 환경변수 보안 검증 통과
3. ✅ Vercel 프로덕션 배포 성공
4. ✅ 가이드라인 준수 체크리스트 80% 이상 통과
5. ✅ 주요 기능 정상 작동 확인

### 프로덕션 배포 준비 완료
- 모든 MVP 기능 정상 작동
- 성능 목표 달성
- 보안 검증 통과
- 코드 품질 기준 충족

