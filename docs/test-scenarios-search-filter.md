# 검색 + 필터 조합 테스트 시나리오

## 개요

이 문서는 검색 기능과 필터 기능의 조합 동작을 검증하기 위한 테스트 시나리오를 정의합니다.

## 테스트 전제 조건

1. 개발 서버 실행 (`pnpm dev`)
2. 브라우저 개발자 도구 열기 (네트워크 탭, 콘솔 탭)
3. 한국관광공사 API 키가 올바르게 설정되어 있어야 함

## 테스트 시나리오

### 시나리오 1: 키워드만 검색 (필터 없음)

**목적**: 기본 검색 기능이 정상 동작하는지 확인

**절차**:
1. 홈페이지 접속 (`/`)
2. 검색창에 "서울" 입력
3. 검색 버튼 클릭 또는 Enter 키 입력

**예상 결과**:
- URL: `/?keyword=서울`
- 검색 결과가 표시됨
- 검색 결과 헤더에 "서울" 검색 결과: 총 N개 표시
- 필터 정보는 표시되지 않음 (필터 미적용)

**확인 사항**:
- 콘솔 로그에서 `[Home] Fetching tour search` 확인
- 필터 상태 로그에서 `hasAreaFilter: false`, `hasTypeFilter: false` 확인
- API 요청 URL에 `keyword=서울`만 포함되어야 함
- `areaCode`, `contentTypeId` 파라미터는 포함되지 않아야 함

---

### 시나리오 2: 키워드 + 지역 필터

**목적**: 검색과 지역 필터 조합이 정상 동작하는지 확인

**절차**:
1. 홈페이지 접속 (`/`)
2. 지역 필터에서 "부산" 선택
3. 검색창에 "해변" 입력
4. 검색 버튼 클릭 또는 Enter 키 입력

**예상 결과**:
- URL: `/?keyword=해변&areaCode=6` (부산 지역코드는 6)
- 검색 결과가 표시됨
- 검색 결과 헤더에 "해변" 검색 결과: 총 N개 표시
- 필터 정보에 "지역: 부산" 표시

**확인 사항**:
- 콘솔 로그에서 필터 상태 로그 확인: `hasAreaFilter: true`, `areaCode: "6"`
- API 요청 URL에 `keyword=해변&areaCode=6` 포함 확인
- `[Tour API] Added filter param: areaCode = 6` 로그 확인
- 검색 결과가 부산 지역의 해변 관련 관광지만 표시되는지 확인

---

### 시나리오 3: 키워드 + 타입 필터

**목적**: 검색과 관광 타입 필터 조합이 정상 동작하는지 확인

**절차**:
1. 홈페이지 접속 (`/`)
2. 관광 타입 필터에서 "관광지" 선택
3. 검색창에 "공원" 입력
4. 검색 버튼 클릭 또는 Enter 키 입력

**예상 결과**:
- URL: `/?keyword=공원&contentTypeId=12` (관광지 타입코드는 12)
- 검색 결과가 표시됨
- 검색 결과 헤더에 "공원" 검색 결과: 총 N개 표시
- 필터 정보에 "타입: 관광지" 표시

**확인 사항**:
- 콘솔 로그에서 필터 상태 로그 확인: `hasTypeFilter: true`, `contentTypeId: "12"`
- API 요청 URL에 `keyword=공원&contentTypeId=12` 포함 확인
- `[Tour API] Added filter param: contentTypeId = 12` 로그 확인
- 검색 결과가 관광지 타입의 공원 관련 관광지만 표시되는지 확인

---

### 시나리오 4: 키워드 + 지역 + 타입 필터

**목적**: 검색과 모든 필터 조합이 정상 동작하는지 확인

**절차**:
1. 홈페이지 접속 (`/`)
2. 지역 필터에서 "제주" 선택
3. 관광 타입 필터에서 "음식점" 선택
4. 검색창에 "한식" 입력
5. 검색 버튼 클릭 또는 Enter 키 입력

**예상 결과**:
- URL: `/?keyword=한식&areaCode=39&contentTypeId=39` (제주 지역코드 39, 음식점 타입코드 39)
- 검색 결과가 표시됨
- 검색 결과 헤더에 "한식" 검색 결과: 총 N개 표시
- 필터 정보에 "지역: 제주 · 타입: 음식점" 표시

**확인 사항**:
- 콘솔 로그에서 필터 상태 로그 확인:
  - `hasAreaFilter: true`, `areaCode: "39"`
  - `hasTypeFilter: true`, `contentTypeId: "39"`
- API 요청 URL에 모든 파라미터 포함 확인: `keyword=한식&areaCode=39&contentTypeId=39`
- `[Tour API] Filter params summary` 로그에서 `hasAreaFilter: true`, `hasTypeFilter: true` 확인
- 검색 결과가 제주 지역의 음식점 타입 한식 관련 관광지만 표시되는지 확인

---

### 시나리오 5: 필터만 적용 (검색어 없음)

**목적**: 필터만 사용하는 기존 동작이 정상인지 확인

**절차**:
1. 홈페이지 접속 (`/`)
2. 지역 필터에서 "경기" 선택
3. 관광 타입 필터에서 "문화시설" 선택
4. 검색하지 않고 필터만 적용

**예상 결과**:
- URL: `/?areaCode=31&contentTypeId=14` (경기 지역코드 31, 문화시설 타입코드 14)
- `fetchTourList` 함수 호출 (검색 함수 아님)
- 필터링된 목록이 표시됨
- 검색 결과 헤더는 표시되지 않음 (검색어 없음)

**확인 사항**:
- 콘솔 로그에서 `[Home] Fetching tour list` 확인 (검색 함수 아님)
- API 요청이 `areaBasedList` 엔드포인트로 전송되는지 확인
- 검색 결과 헤더가 표시되지 않는지 확인

---

### 시나리오 6: 검색 후 필터 변경

**목적**: 검색 후 필터를 변경했을 때 검색어가 유지되는지 확인

**절차**:
1. 검색창에 "박물관" 입력 후 검색
2. 지역 필터에서 "서울" 선택
3. 관광 타입 필터에서 "문화시설" 선택

**예상 결과**:
- URL: `/?keyword=박물관&areaCode=1&contentTypeId=14`
- 검색어 "박물관"이 유지됨
- 필터가 적용된 검색 결과가 표시됨
- 검색 결과 헤더에 "박물관" 검색 결과와 필터 정보 모두 표시

**확인 사항**:
- URL 파라미터에 `keyword=박물관`이 유지되는지 확인
- 검색창에 "박물관"이 그대로 표시되는지 확인
- 필터 변경 시 `fetchTourSearch` 함수가 호출되는지 확인
- 검색 결과가 필터 조건에 맞게 업데이트되는지 확인

---

### 시나리오 7: 필터 적용 후 검색

**목적**: 필터 적용 후 검색했을 때 필터가 유지되는지 확인

**절차**:
1. 지역 필터에서 "인천" 선택
2. 관광 타입 필터에서 "레포츠" 선택
3. 검색창에 "수영장" 입력 후 검색

**예상 결과**:
- URL: `/?keyword=수영장&areaCode=2&contentTypeId=28` (인천 지역코드 2, 레포츠 타입코드 28)
- 필터가 유지됨 (인천, 레포츠)
- 검색 결과가 필터 조건에 맞게 표시됨

**확인 사항**:
- URL 파라미터에 필터 정보가 유지되는지 확인
- 필터 UI에서 선택된 필터가 그대로 표시되는지 확인
- 검색 결과가 필터 조건에 맞는지 확인

---

## 로그 확인 체크리스트

각 테스트 시나리오 실행 시 다음 로그들을 확인하세요:

### 클라이언트 사이드 로그 (브라우저 콘솔)

- `[TourSearch] 검색 실행` - 검색어와 URL 파라미터 확인
- `[TourFilters] 필터 업데이트` - 필터 변경 시 파라미터 확인

### 서버 사이드 로그 (터미널)

#### `fetchTourSearch` 함수 로그:
- `[Home] Fetching tour search` - 검색 시작
- `Input params` - 입력 파라미터 확인
- `Filter status` - 필터 상태 확인
- `Added areaCode filter` 또는 `No areaCode filter applied`
- `Added contentTypeId filter` 또는 `No contentTypeId filter applied`
- `Final API params` - 최종 API 파라미터 확인
- `Success` - 검색 결과 개수와 필터 정보

#### API 라우트 로그:
- `[Tour API] Optional params config` - 선택적 파라미터 설정 확인
- `[Tour API] Added filter param` - 필터 파라미터 추가 확인
- `[Tour API] Filter params summary` - 필터 파라미터 요약
- `[Tour API] Search params verification` - 최종 검색 파라미터 확인

## 예상 오류 및 대응

### 오류 1: 필터 파라미터가 API 요청에 포함되지 않음

**증상**: 로그에서 필터 파라미터가 추가되지 않음

**확인 사항**:
- `fetchTourSearch` 함수 호출 시 파라미터 전달 확인
- URL 파라미터 파싱 확인
- API 라우트의 선택적 파라미터 처리 로직 확인

### 오류 2: API가 필터 파라미터를 무시함

**증상**: 필터를 적용해도 결과가 변경되지 않음

**확인 사항**:
- 한국관광공사 API 문서에서 `searchKeyword2` 엔드포인트의 필터 파라미터 지원 여부 확인
- API 응답 데이터 확인
- 필요시 클라이언트 사이드 필터링 추가 고려

### 오류 3: URL 파라미터 동기화 문제

**증상**: 필터 변경 시 검색어가 사라지거나, 검색 시 필터가 초기화됨

**확인 사항**:
- `updateUrlParam` 유틸리티 함수 동작 확인
- `preserveKeys` 파라미터 설정 확인
- URL 파라미터 상태 확인

## 테스트 완료 기준

다음 조건을 모두 만족하면 테스트 통과:

1. ✅ 모든 시나리오에서 예상 결과대로 동작
2. ✅ 로그에서 필터 파라미터가 올바르게 전달되는지 확인
3. ✅ API 요청 URL에 필터 파라미터가 포함되는지 확인
4. ✅ 검색 결과가 필터 조건에 맞게 표시되는지 확인
5. ✅ UI에서 필터 정보가 올바르게 표시되는지 확인
6. ✅ URL 파라미터가 올바르게 유지되는지 확인



